usb 3-1: USB disconnect, device number 2
==================================================================
BUG: KASAN: slab-use-after-free in hci_send_acl+0x3d/0x100 home/jiakai/62_66_amd_0901/linux66/linux/net/bluetooth/hci_core.c:3231
Read of size 8 at addr ffff88806758e218 by task kworker/1:3/1231

CPU: 1 PID: 1231 Comm: kworker/1:3 Not tainted 6.6.0 #1
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Workqueue: events l2cap_info_timeout
Call Trace:
 <TASK>
 __dump_stack home/jiakai/62_66_amd_0901/linux66/linux/lib/dump_stack.c:88 [inline]
 dump_stack_lvl+0x1e3/0x2d0 home/jiakai/62_66_amd_0901/linux66/linux/lib/dump_stack.c:106
 print_address_description+0x78/0x390 home/jiakai/62_66_amd_0901/linux66/linux/mm/kasan/report.c:364
 print_report+0x107/0x220 home/jiakai/62_66_amd_0901/linux66/linux/mm/kasan/report.c:475
 kasan_report+0x141/0x170 home/jiakai/62_66_amd_0901/linux66/linux/mm/kasan/report.c:588
 hci_send_acl+0x3d/0x100 home/jiakai/62_66_amd_0901/linux66/linux/net/bluetooth/hci_core.c:3231
 l2cap_send_cmd home/jiakai/62_66_amd_0901/linux66/linux/net/bluetooth/l2cap_core.c:977 [inline]
 l2cap_send_conn_req+0x30e/0x4c0 home/jiakai/62_66_amd_0901/linux66/linux/net/bluetooth/l2cap_core.c:1286
 l2cap_conn_start+0xbc2/0x14c0 home/jiakai/62_66_amd_0901/linux66/linux/net/bluetooth/l2cap_core.c:1661
 process_one_work home/jiakai/62_66_amd_0901/linux66/linux/kernel/workqueue.c:2630 [inline]
 process_scheduled_works+0x8c5/0x1130 home/jiakai/62_66_amd_0901/linux66/linux/kernel/workqueue.c:2703
 worker_thread+0xa7a/0x1040 home/jiakai/62_66_amd_0901/linux66/linux/kernel/workqueue.c:2784
 kthread+0x2cd/0x360 home/jiakai/62_66_amd_0901/linux66/linux/kernel/kthread.c:388
 ret_from_fork+0x44/0x70 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/kernel/process.c:147
 ret_from_fork_asm+0x11/0x20 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/entry/entry_64.S:304
 </TASK>

Allocated by task 962:
 kasan_save_stack home/jiakai/62_66_amd_0901/linux66/linux/mm/kasan/common.c:45 [inline]
 kasan_set_track+0x4c/0x70 home/jiakai/62_66_amd_0901/linux66/linux/mm/kasan/common.c:52
 ____kasan_kmalloc home/jiakai/62_66_amd_0901/linux66/linux/mm/kasan/common.c:374 [inline]
 __kasan_kmalloc+0x94/0xa0 home/jiakai/62_66_amd_0901/linux66/linux/mm/kasan/common.c:383
 kmalloc home/jiakai/62_66_amd_0901/linux66/linux/include/linux/slab.h:599 [inline]
 dummy_urb_enqueue+0x78/0x790 home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/gadget/udc/dummy_hcd.c:1269
 usb_hcd_submit_urb+0x2be/0x5f0 home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/hcd.c:1535
 usb_start_wait_urb+0x10e/0x510 home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/message.c:59
 usb_internal_control_msg home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/message.c:103 [inline]
 usb_control_msg+0x2a5/0x4b0 home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/message.c:154
 usb_get_string+0xa2/0x3b0 home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/message.c:844
 usb_string_sub+0x71/0x410 home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/message.c:883
 usb_get_langid+0xb6/0x430 home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/message.c:920
 usb_string+0x116/0x2e0 home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/message.c:984
 usb_cache_string+0x7b/0x120 home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/message.c:1030
 usb_enumerate_device home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/hub.c:2442 [inline]
 usb_new_device+0x36f/0x18b0 home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/hub.c:2567
 hub_port_connect+0xe6a/0x2130 home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/hub.c:5459
 hub_port_connect_change+0x53d/0x8e0 home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/hub.c:5599
 port_event+0xecf/0x13b0 home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/hub.c:5759
 hub_event+0x5c1/0xd50 home/jiakai/62_66_amd_0901/linux66/linux/drivers/usb/core/hub.c:5841
 process_one_work home/jiakai/62_66_amd_0901/linux66/linux/kernel/workqueue.c:2630 [inline]
 process_scheduled_works+0x8c5/0x1130 home/jiakai/62_66_amd_0901/linux66/linux/kernel/workqueue.c:2703
 worker_thread+0xa7a/0x1040 home/jiakai/62_66_amd_0901/linux66/linux/kernel/workqueue.c:2784
 kthread+0x2cd/0x360 home/jiakai/62_66_amd_0901/linux66/linux/kernel/kthread.c:388
 ret_from_fork+0x44/0x70 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/kernel/process.c:147
 ret_from_fork_asm+0x11/0x20 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/entry/entry_64.S:304

The buggy address belongs to the object at ffff88806758e200
 which belongs to the cache kmalloc-128 of size 128
The buggy address is located 24 bytes inside of
 freed 128-byte region [ffff88806758e200, ffff88806758e280)

The buggy address belongs to the physical page:
page:ffffea00019d6380 refcount:1 mapcount:0 mapping:0000000000000000 index:0xffff88806758e200 pfn:0x6758e
flags: 0x4fff00000000800(slab|node=1|zone=1|lastcpupid=0x7ff)
page_type: 0xffffffff()
raw: 04fff00000000800 ffff8880188418c0 ffffea00018e2f50 ffffea0001932590
raw: ffff88806758e200 0000000000100006 00000001ffffffff 0000000000000000
page dumped because: kasan: bad access detected
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x112cc0(GFP_USER|__GFP_NOWARN|__GFP_NORETRY), pid 10767, tgid 10767 (syz.2.6), ts 206190712781, free_ts 0
 set_page_owner home/jiakai/62_66_amd_0901/linux66/linux/include/linux/page_owner.h:31 [inline]
 post_alloc_hook+0x1f4/0x220 home/jiakai/62_66_amd_0901/linux66/linux/mm/page_alloc.c:1536
 prep_new_page home/jiakai/62_66_amd_0901/linux66/linux/mm/page_alloc.c:1543 [inline]
 get_page_from_freelist+0x72b/0x7a0 home/jiakai/62_66_amd_0901/linux66/linux/mm/page_alloc.c:3170
 __alloc_pages+0x259/0x560 home/jiakai/62_66_amd_0901/linux66/linux/mm/page_alloc.c:4426
 alloc_slab_page+0xbe/0x190 home/jiakai/62_66_amd_0901/linux66/linux/mm/slub.c:1870
 allocate_slab+0x5e/0x3c0 home/jiakai/62_66_amd_0901/linux66/linux/mm/slub.c:2017
 new_slab home/jiakai/62_66_amd_0901/linux66/linux/mm/slub.c:2070 [inline]
 ___slab_alloc+0xa0f/0x1130 home/jiakai/62_66_amd_0901/linux66/linux/mm/slub.c:3223
 __slab_alloc home/jiakai/62_66_amd_0901/linux66/linux/mm/slub.c:3322 [inline]
 __slab_alloc_node home/jiakai/62_66_amd_0901/linux66/linux/mm/slub.c:3375 [inline]
 slab_alloc_node home/jiakai/62_66_amd_0901/linux66/linux/mm/slub.c:3468 [inline]
 __kmem_cache_alloc_node+0x23b/0x320 home/jiakai/62_66_amd_0901/linux66/linux/mm/slub.c:3517
 __do_kmalloc_node home/jiakai/62_66_amd_0901/linux66/linux/mm/slab_common.c:1025 [inline]
 __kmalloc+0x9e/0x190 home/jiakai/62_66_amd_0901/linux66/linux/mm/slab_common.c:1039
 task_numa_fault+0x3da2/0x4dd0 home/jiakai/62_66_amd_0901/linux66/linux/kernel/sched/fair.c:3120
 do_numa_page+0xa2a/0x1400 home/jiakai/62_66_amd_0901/linux66/linux/mm/memory.c:4838
 handle_pte_fault+0x3b1/0xce0 home/jiakai/62_66_amd_0901/linux66/linux/mm/memory.c:4987
 __handle_mm_fault+0xb2e/0xf20 home/jiakai/62_66_amd_0901/linux66/linux/mm/memory.c:5122
 handle_mm_fault+0x3b9/0x860 home/jiakai/62_66_amd_0901/linux66/linux/mm/memory.c:5287
 do_user_addr_fault+0xa73/0x11b0 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/mm/fault.c:1364
 handle_page_fault home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/mm/fault.c:1505 [inline]
 exc_page_fault+0x7a/0x120 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/mm/fault.c:1561
 asm_exc_page_fault+0x22/0x30 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/include/asm/idtentry.h:570
page_owner free stack trace missing

Memory state around the buggy address:
 ffff88806758e100: 00 00 00 00 00 00 00 00 00 00 00 00 00 fc fc fc
 ffff88806758e180: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
>ffff88806758e200: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
                            ^
 ffff88806758e280: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
 ffff88806758e300: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
==================================================================

<<<<<<<<<<<<<<< tail report >>>>>>>>>>>>>>>

 usb_string+0x116/0x2e0
 usb_cache_string+0x7b/0x120
 usb_new_device+0x36f/0x18b0
 hub_port_connect+0xe6a/0x2130
 hub_port_connect_change+0x53d/0x8e0
 port_event+0xecf/0x13b0
 hub_event+0x5c1/0xd50
 process_scheduled_works+0x8c5/0x1130
 worker_thread+0xa7a/0x1040
 kthread+0x2cd/0x360
 ret_from_fork+0x44/0x70
 ret_from_fork_asm+0x11/0x20
The buggy address belongs to the object at ffff88806758e200
 which belongs to the cache kmalloc-128 of size 128
The buggy address is located 24 bytes inside of
 freed 128-byte region [ffff88806758e200, ffff88806758e280)
The buggy address belongs to the physical page:
page:ffffea00019d6380 refcount:1 mapcount:0 mapping:0000000000000000 index:0xffff88806758e200 pfn:0x6758e
flags: 0x4fff00000000800(slab|node=1|zone=1|lastcpupid=0x7ff)
page_type: 0xffffffff()
raw: 04fff00000000800 ffff8880188418c0 ffffea00018e2f50 ffffea0001932590
raw: ffff88806758e200 0000000000100006 00000001ffffffff 0000000000000000
page dumped because: kasan: bad access detected
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x112cc0(GFP_USER|__GFP_NOWARN|__GFP_NORETRY), pid 10767, tgid 10767 (syz.2.6), ts 206190712781, free_ts 0
 post_alloc_hook+0x1f4/0x220
 get_page_from_freelist+0x72b/0x7a0
 __alloc_pages+0x259/0x560
 alloc_slab_page+0xbe/0x190
 allocate_slab+0x5e/0x3c0
 ___slab_alloc+0xa0f/0x1130
 __kmem_cache_alloc_node+0x23b/0x320
 __kmalloc+0x9e/0x190
 task_numa_fault+0x3da2/0x4dd0
 do_numa_page+0xa2a/0x1400
 handle_pte_fault+0x3b1/0xce0
 __handle_mm_fault+0xb2e/0xf20
 handle_mm_fault+0x3b9/0x860
 do_user_addr_fault+0xa73/0x11b0
 exc_page_fault+0x7a/0x120
 asm_exc_page_fault+0x22/0x30
page_owner free stack trace missing
Memory state around the buggy address:
 ffff88806758e100: 00 00 00 00 00 00 00 00 00 00 00 00 00 fc fc fc
 ffff88806758e180: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
>ffff88806758e200: fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb fb
                            ^
 ffff88806758e280: fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc fc
 ffff88806758e300: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
==================================================================
Kernel panic - not syncing: KASAN: panic_on_warn set ...
CPU: 1 PID: 1231 Comm: kworker/1:3 Not tainted 6.6.0 #1
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Workqueue: events l2cap_info_timeout
Call Trace:
 <TASK>
 dump_stack_lvl+0x1e3/0x2d0
 panic+0x2f5/0x760
 check_panic_on_warn+0x80/0xa0
 end_report+0x4a/0xb0
 kasan_report+0x152/0x170
 hci_send_acl+0x3d/0x100
 l2cap_send_conn_req+0x30e/0x4c0
 l2cap_conn_start+0xbc2/0x14c0
 process_scheduled_works+0x8c5/0x1130
 worker_thread+0xa7a/0x1040
 kthread+0x2cd/0x360
 ret_from_fork+0x44/0x70
 ret_from_fork_asm+0x11/0x20
 </TASK>
Kernel Offset: disabled
Rebooting in 86400 seconds..

<<<<<<<<<<<<<<< tail report >>>>>>>>>>>>>>>

