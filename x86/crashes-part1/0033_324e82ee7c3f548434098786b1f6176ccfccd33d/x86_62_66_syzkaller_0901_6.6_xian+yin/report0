==================================================================
BUG: KASAN: stack-out-of-bounds in profile_pc+0xcf/0x150 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/kernel/time.c:42
Read of size 8 at addr ffffc900021c7b20 by task systemd-udevd/5175

CPU: 0 PID: 5175 Comm: systemd-udevd Not tainted 6.6.0 #1
Hardware name: QEMU Standard PC (i440FX + PIIX, 1996), BIOS 1.15.0-1 04/01/2014
Call Trace:
 <IRQ>
 __dump_stack home/jiakai/62_66_amd_0901/linux66/linux/lib/dump_stack.c:88 [inline]
 dump_stack_lvl+0x1e3/0x2d0 home/jiakai/62_66_amd_0901/linux66/linux/lib/dump_stack.c:106
 print_address_description+0x78/0x390 home/jiakai/62_66_amd_0901/linux66/linux/mm/kasan/report.c:364
 print_report+0x107/0x220 home/jiakai/62_66_amd_0901/linux66/linux/mm/kasan/report.c:475
 kasan_report+0x141/0x170 home/jiakai/62_66_amd_0901/linux66/linux/mm/kasan/report.c:588
 profile_pc+0xcf/0x150 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/kernel/time.c:42
 profile_tick+0xcd/0x120 home/jiakai/62_66_amd_0901/linux66/linux/kernel/profile.c:339
 tick_sched_handle home/jiakai/62_66_amd_0901/linux66/linux/kernel/time/tick-sched.c:255 [inline]
 tick_sched_timer+0x38f/0x550 home/jiakai/62_66_amd_0901/linux66/linux/kernel/time/tick-sched.c:1492
 __run_hrtimer home/jiakai/62_66_amd_0901/linux66/linux/kernel/time/hrtimer.c:1688 [inline]
 __hrtimer_run_queues+0x4cb/0xa60 home/jiakai/62_66_amd_0901/linux66/linux/kernel/time/hrtimer.c:1752
 hrtimer_interrupt+0x3a6/0xfd0 home/jiakai/62_66_amd_0901/linux66/linux/kernel/time/hrtimer.c:1814
 local_apic_timer_interrupt home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/kernel/apic/apic.c:1063 [inline]
 __sysvec_apic_timer_interrupt+0xb6/0x170 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/kernel/apic/apic.c:1080
 sysvec_apic_timer_interrupt+0x8c/0xb0 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/kernel/apic/apic.c:1074
 </IRQ>
 <TASK>
 asm_sysvec_apic_timer_interrupt+0x16/0x20 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/include/asm/idtentry.h:645
RIP: 0010:__raw_spin_unlock_irqrestore home/jiakai/62_66_amd_0901/linux66/linux/include/linux/spinlock_api_smp.h:152 [inline]
RIP: 0010:_raw_spin_unlock_irqrestore+0xd4/0x130 home/jiakai/62_66_amd_0901/linux66/linux/kernel/locking/spinlock.c:194
Code: 9c 8f 44 24 20 42 80 3c 23 00 74 08 4c 89 f7 e8 02 b2 cb f6 f6 44 24 21 02 75 4e 41 f7 c7 00 02 00 00 74 01 fb bf 01 00 00 00 <e8> 07 82 41 f6 65 8b 05 08 d7 e4 74 85 c0 74 3f 48 c7 04 24 0e 36
RSP: 0018:ffffc900021c7b20 EFLAGS: 00000206
RAX: a38b3cd263099600 RBX: 1ffff92000438f68 RCX: ffffffff816d90da
RDX: dffffc0000000000 RSI: ffffffff8b4dfb00 RDI: 0000000000000001
RBP: ffffc900021c7bb0 R08: ffffffff91cee427 R09: 1ffffffff239dc84
R10: dffffc0000000000 R11: fffffbfff239dc85 R12: dffffc0000000000
R13: 1ffff92000438f64 R14: ffffc900021c7b40 R15: 0000000000000246
 debug_object_activate+0x3c9/0x530 home/jiakai/62_66_amd_0901/linux66/linux/lib/debugobjects.c:745
 debug_rcu_head_queue home/jiakai/62_66_amd_0901/linux66/linux/kernel/rcu/rcu.h:226 [inline]
 kvfree_call_rcu+0x95/0x7a0 home/jiakai/62_66_amd_0901/linux66/linux/kernel/rcu/tree.c:3363
 kernfs_unlink_open_file+0x427/0x510 home/jiakai/62_66_amd_0901/linux66/linux/fs/kernfs/file.c:633
 kernfs_fop_release+0x2f6/0x440 home/jiakai/62_66_amd_0901/linux66/linux/fs/kernfs/file.c:805
 __fput+0x405/0x940 home/jiakai/62_66_amd_0901/linux66/linux/fs/file_table.c:384
 __do_sys_close home/jiakai/62_66_amd_0901/linux66/linux/fs/open.c:1572 [inline]
 __se_sys_close+0x155/0x1e0 home/jiakai/62_66_amd_0901/linux66/linux/fs/open.c:1557
 do_syscall_x64 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/entry/common.c:50 [inline]
 do_syscall_64+0x2b/0x50 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/entry/common.c:80
 entry_SYSCALL_64_after_hwframe+0x63/0xcd
RIP: 0033:0x7f60da8df387
Code: 44 00 00 48 8b 15 09 db 0d 00 f7 d8 64 89 02 b8 ff ff ff ff eb bc 66 2e 0f 1f 84 00 00 00 00 00 0f 1f 00 b8 03 00 00 00 0f 05 <48> 3d 00 f0 ff ff 77 01 c3 48 8b 15 d9 da 0d 00 f7 d8 64 89 02 b8
RSP: 002b:00007fff083bd438 EFLAGS: 00000202 ORIG_RAX: 0000000000000003
RAX: ffffffffffffffda RBX: 00005646f00d1770 RCX: 00007f60da8df387
RDX: 00007f60da9b9880 RSI: 0000000000000000 RDI: 000000000000000e
RBP: 0000000000000000 R08: 0000000000008000 R09: 00007f60da9bdbe0
R10: 0000000000000010 R11: 0000000000000202 R12: 00007f60da9ba480
R13: 0000000000000000 R14: 0000000000001001 R15: 0000000000000000
 </TASK>

The buggy address belongs to stack of task systemd-udevd/5175
 and is located at offset 0 in frame:
 _raw_spin_unlock_irqrestore+0x0/0x130 home/jiakai/62_66_amd_0901/linux66/linux/kernel/locking/spinlock.c:187

This frame has 1 object:
 [32, 40) 'flags.i.i.i.i'

The buggy address belongs to the virtual mapping at
 [ffffc900021c0000, ffffc900021c9000) created by:
 dup_task_struct+0x8b/0x5a0 home/jiakai/62_66_amd_0901/linux66/linux/kernel/fork.c:1118

The buggy address belongs to the physical page:
page:ffffea00012bfa40 refcount:1 mapcount:0 mapping:0000000000000000 index:0x0 pfn:0x4afe9
memcg:ffff8880498cb302
flags: 0x4fff00000000000(node=1|zone=1|lastcpupid=0x7ff)
page_type: 0xffffffff()
raw: 04fff00000000000 0000000000000000 dead000000000122 0000000000000000
raw: 0000000000000000 0000000000000000 00000001ffffffff ffff8880498cb302
page dumped because: kasan: bad access detected
page_owner tracks the page as allocated
page last allocated via order 0, migratetype Unmovable, gfp_mask 0x2dc2(GFP_KERNEL|__GFP_HIGHMEM|__GFP_NOWARN|__GFP_ZERO), pid 1, tgid 1 (systemd), ts 66564699446, free_ts 59989265786
 set_page_owner home/jiakai/62_66_amd_0901/linux66/linux/include/linux/page_owner.h:31 [inline]
 post_alloc_hook+0x1f4/0x220 home/jiakai/62_66_amd_0901/linux66/linux/mm/page_alloc.c:1536
 prep_new_page home/jiakai/62_66_amd_0901/linux66/linux/mm/page_alloc.c:1543 [inline]
 get_page_from_freelist+0x72b/0x7a0 home/jiakai/62_66_amd_0901/linux66/linux/mm/page_alloc.c:3170
 __alloc_pages+0x259/0x560 home/jiakai/62_66_amd_0901/linux66/linux/mm/page_alloc.c:4426
 vm_area_alloc_pages home/jiakai/62_66_amd_0901/linux66/linux/mm/vmalloc.c:3063 [inline]
 __vmalloc_area_node home/jiakai/62_66_amd_0901/linux66/linux/mm/vmalloc.c:3139 [inline]
 __vmalloc_node_range+0x9e2/0x14f0 home/jiakai/62_66_amd_0901/linux66/linux/mm/vmalloc.c:3320
 alloc_thread_stack_node+0x32e/0x580 home/jiakai/62_66_amd_0901/linux66/linux/kernel/fork.c:309
 dup_task_struct+0x8b/0x5a0 home/jiakai/62_66_amd_0901/linux66/linux/kernel/fork.c:1118
 copy_process+0x586/0x4050 home/jiakai/62_66_amd_0901/linux66/linux/kernel/fork.c:2327
 kernel_clone+0x224/0x6d0 home/jiakai/62_66_amd_0901/linux66/linux/kernel/fork.c:2909
 __do_sys_clone home/jiakai/62_66_amd_0901/linux66/linux/kernel/fork.c:3052 [inline]
 __se_sys_clone home/jiakai/62_66_amd_0901/linux66/linux/kernel/fork.c:3036 [inline]
 __x64_sys_clone+0x28d/0x300 home/jiakai/62_66_amd_0901/linux66/linux/kernel/fork.c:3036
 do_syscall_x64 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/entry/common.c:50 [inline]
 do_syscall_64+0x2b/0x50 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/entry/common.c:80
 entry_SYSCALL_64_after_hwframe+0x63/0xcd
page last free stack trace:
 reset_page_owner home/jiakai/62_66_amd_0901/linux66/linux/include/linux/page_owner.h:24 [inline]
 free_pages_prepare home/jiakai/62_66_amd_0901/linux66/linux/mm/page_alloc.c:1136 [inline]
 free_unref_page_prepare+0x7f0/0x900 home/jiakai/62_66_amd_0901/linux66/linux/mm/page_alloc.c:2312
 free_unref_page+0x30/0x3c0 home/jiakai/62_66_amd_0901/linux66/linux/mm/page_alloc.c:2405
 kasan_depopulate_vmalloc_pte+0x70/0x90 home/jiakai/62_66_amd_0901/linux66/linux/mm/kasan/shadow.c:427
 apply_to_pte_range home/jiakai/62_66_amd_0901/linux66/linux/mm/memory.c:2589 [inline]
 apply_to_pmd_range home/jiakai/62_66_amd_0901/linux66/linux/mm/memory.c:2633 [inline]
 apply_to_pud_range home/jiakai/62_66_amd_0901/linux66/linux/mm/memory.c:2669 [inline]
 apply_to_p4d_range home/jiakai/62_66_amd_0901/linux66/linux/mm/memory.c:2705 [inline]
 __apply_to_page_range+0x874/0xdb0 home/jiakai/62_66_amd_0901/linux66/linux/mm/memory.c:2739
 kasan_release_vmalloc+0x96/0xb0 home/jiakai/62_66_amd_0901/linux66/linux/mm/kasan/shadow.c:544
 __purge_vmap_area_lazy+0xcec/0x18e0 home/jiakai/62_66_amd_0901/linux66/linux/mm/vmalloc.c:1770
 _vm_unmap_aliases+0x86e/0x910 home/jiakai/62_66_amd_0901/linux66/linux/mm/vmalloc.c:2306
 change_page_attr_set_clr+0x2d0/0x660 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/mm/pat/set_memory.c:1838
 change_page_attr_set home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/mm/pat/set_memory.c:1879 [inline]
 set_memory_nx+0xee/0x130 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/mm/pat/set_memory.c:2072
 free_init_pages home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/mm/init.c:927 [inline]
 free_kernel_image_pages home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/mm/init.c:946 [inline]
 free_initmem+0x71/0xc0 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/mm/init.c:973
 kernel_init+0x2d/0x2b0 home/jiakai/62_66_amd_0901/linux66/linux/init/main.c:1446
 ret_from_fork+0x44/0x70 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/kernel/process.c:147
 ret_from_fork_asm+0x11/0x20 home/jiakai/62_66_amd_0901/linux66/linux/arch/x86/entry/entry_64.S:304

Memory state around the buggy address:
 ffffc900021c7a00: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 ffffc900021c7a80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
>ffffc900021c7b00: 00 00 00 00 f1 f1 f1 f1 00 f3 f3 f3 00 00 00 00
                               ^
 ffffc900021c7b80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
 ffffc900021c7c00: f1 f1 f1 f1 00 00 00 00 00 f3 f3 f3 f3 f3 f3 f3
==================================================================
----------------
Code disassembly (best guess):
   0:	9c                   	pushf
   1:	8f 44 24 20          	pop    0x20(%rsp)
   5:	42 80 3c 23 00       	cmpb   $0x0,(%rbx,%r12,1)
   a:	74 08                	je     0x14
   c:	4c 89 f7             	mov    %r14,%rdi
   f:	e8 02 b2 cb f6       	call   0xf6cbb216
  14:	f6 44 24 21 02       	testb  $0x2,0x21(%rsp)
  19:	75 4e                	jne    0x69
  1b:	41 f7 c7 00 02 00 00 	test   $0x200,%r15d
  22:	74 01                	je     0x25
  24:	fb                   	sti
  25:	bf 01 00 00 00       	mov    $0x1,%edi
* 2a:	e8 07 82 41 f6       	call   0xf6418236 <-- trapping instruction
  2f:	65 8b 05 08 d7 e4 74 	mov    %gs:0x74e4d708(%rip),%eax        # 0x74e4d73e
  36:	85 c0                	test   %eax,%eax
  38:	74 3f                	je     0x79
  3a:	48                   	rex.W
  3b:	c7                   	.byte 0xc7
  3c:	04 24                	add    $0x24,%al
  3e:	0e                   	(bad)
  3f:	36                   	ss
